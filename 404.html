<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Opening YouSport App...</title>
    <script>
      let fallbackTimeout;

      function isAlreadyInBrowser() {
        return window.location.search.includes("from=fallback");
      }

      window.onload = function () {
        const path = window.location.pathname;

        const cleanPath = path
          .replace("/yousport-links", "")
          .replace(/^\/+/, "");

        const appLink = `yousport://${cleanPath}`;

        if (!isAlreadyInBrowser()) {
          // Try to open the app
          window.location.href = appLink;

          // Fallback after delay
          fallbackTimeout = setTimeout(() => {
            const fallbackUrl = window.location.href.includes("?")
              ? window.location.href + "&from=fallback"
              : window.location.href + "?from=fallback";
            window.location.href = fallbackUrl;
          }, 5000);
        }
      };
    </script>
    <style>
      .fallback-button {
        display: inline-block;
        padding: 10px 16px;
        background-color: #007bff;
        color: white;
        text-decoration: none;
        border-radius: 6px;
        margin-top: 12px;
      }
    </style>
  </head>
  <body>
    <p>Trying to open the app...</p>

    <!-- Fallback link (only shown before redirect) -->
    <p id="fallback-message" style="display: none">
      If your app didn't open,
      <a id="fallback-link" class="fallback-button" target="_blank"
        >Tap here to open in your browser</a
      >
    </p>

    <script>
      if (!isAlreadyInBrowser()) {
        const fallbackUrl = window.location.href.includes("?")
          ? window.location.href + "&from=fallback"
          : window.location.href + "?from=fallback";

        const link = document.getElementById("fallback-link");
        link.href = fallbackUrl;
        document.getElementById("fallback-message").style.display = "block";
      }
    </script>
  </body>
</html>
